"use strict";function Universe(t){var e=[],i=[];this.addBody=function(t){switch(t.type){case"fixed":e.push(new MovableBody(t.mass,t.coords,t.isRepeller));break;case"movable":i.push(new MovableBody(t.mass,t.coords,t.velocity,!1))}}}function Body(t,e,i,s){this.id=n,this.isActive=!0,n++,this.mass=t,this.coords=e,this.velocity=i,this.radius=DEFAULT_UNIVERSE_SETTINGS.sizeMultiplier*Math.pow(t/Math.PI*.75,1/3),this.isRepeller=s,this.fillStyle=s?"red":"blue",this.draw=function(){ctx.fillStyle=this.fillStyle,ctx.beginPath(),ctx.arc(this.coords.x,this.coords.y,this.radius,0,2*Math.PI,!1),ctx.fill()},this.draw()}function FixedBody(t,e,i,s){Body.call(this,t,e,i,s),this.update=function(){this.velocity={x:this.velocity.x*(1-DEFAULT_UNIVERSE_SETTINGS.damping/1e5),y:this.velocity.y*(1-DEFAULT_UNIVERSE_SETTINGS.damping/1e5)},this.coords.x+=this.velocity.x,this.coords.y+=this.velocity.y}}function MovableBody(t,e,i,s){Body.call(this,t,e,i,s),this.calcDistanceFrom=function(t){var e={};return e.x=this.coords.x-t.coords.x,e.y=this.coords.y-t.coords.y,e.total=Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2)),e},this.calcForceFromOther=function(t){var e={},i=this.calcDistanceFrom(t);return e.total=DEFAULT_UNIVERSE_SETTINGS.gravity*this.mass*t.mass/Math.pow(i.total,2),e.direction=Math.atan2(i.y,i.x),e.directionDegs=180*e.direction/Math.PI,e},this.update=function(){var t=!0,e=!1,i=void 0;try{for(var s,o=movableBodies[Symbol.iterator]();!(t=(s=o.next()).done);t=!0){var a=s.value;console.log(a===this)}}catch(t){e=!0,i=t}finally{try{!t&&o.return&&o.return()}finally{if(e)throw i}}var r=!0,n=!1,l=void 0;try{for(var d,c=fixedBodies[Symbol.iterator]();!(r=(d=c.next()).done);r=!0){var h=d.value,y=this.calcForceFromOther(h),v={};v.total=y.total/this.mass,v.x=-v.total*Math.cos(y.direction),v.x=h.isRepeller?-v.x:v.x,v.y=-v.total*Math.sin(y.direction),v.y=h.isRepeller?-v.y:v.y,this.velocity={x:this.velocity.x*(1-DEFAULT_UNIVERSE_SETTINGS.damping/1e5)+v.x,y:this.velocity.y*(1-DEFAULT_UNIVERSE_SETTINGS.damping/1e5)+v.y}}}catch(t){n=!0,l=t}finally{try{!r&&c.return&&c.return()}finally{if(n)throw l}}this.coords.x+=this.velocity.x,this.coords.y+=this.velocity.y}}function MovableBodyV2(t,e,i,s,o){Body.call(this,t,e,i,s),this.calcDistanceFrom=function(t){var e={};return e.x=this.coords.x-t.coords.x,e.y=this.coords.y-t.coords.y,e.total=Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2)),e},this.calcForceFromOther=function(t){var e={},i=this.calcDistanceFrom(t);return e.total=DEFAULT_UNIVERSE_SETTINGS.gravity*this.mass*t.mass/Math.pow(i.total,2),e.direction=Math.atan2(i.y,i.x),e.directionDegs=180*e.direction/Math.PI,i.total<1.2*(this.radius+t.radius)&&(e.total=0,console.log("too close")),e},this.update=function(){var t=!0,e=!1,i=void 0;try{for(var s,a=o[Symbol.iterator]();!(t=(s=a.next()).done);t=!0){var r=s.value;if(r!==this&&this.isActive&&r.isActive){var n=this.calcForceFromOther(r),l={};l.total=n.total/this.mass,l.x=-l.total*Math.cos(n.direction),l.x=this.isRepeller!==r.isRepeller?-l.x:l.x,l.y=-l.total*Math.sin(n.direction),l.y=this.isRepeller!==r.isRepeller?-l.y:l.y,this.velocity={x:this.velocity.x*(1-DEFAULT_UNIVERSE_SETTINGS.damping/1e5)+l.x,y:this.velocity.y*(1-DEFAULT_UNIVERSE_SETTINGS.damping/1e5)+l.y},this.calcDistanceFrom(r).total<this.radius+r.radius&&(this.remove(),r.remove(),this.combine(r),console.log(o))}}}catch(t){e=!0,i=t}finally{try{!t&&a.return&&a.return()}finally{if(e)throw i}}this.coords.x+=this.velocity.x,this.coords.y+=this.velocity.y},this.remove=function(){this.isActive=!1;var t=o.indexOf(this);t>-1&&o.splice(t,1)},this.combine=function(t){var e,i=this.coords,s={x:(this.mass*this.velocity.x+t.mass*t.velocity.x)/(this.mass+t.mass),y:(this.mass*this.velocity.y+t.mass*t.velocity.y)/(this.mass+t.mass)};this.isRepeller===t.isRepeller?(e=this.mass+t.mass,console.log(e),o.push(new MovableBodyV2(e,i,s,this.isRepeller,o))):this.mass>t.mass?(e=this.mass-t.mass,o.push(new MovableBodyV2(e,i,s,this.isRepeller,o))):this.mass<t.mass&&(e=t.mass-this.mass,o.push(new MovableBodyV2(e,i,s,t.isRepeller,o))),console.log(this.mass+" + "+t.mass+" = "+e)}}function MovableBodyV3(t,e){this.id=n,this.isActive=!0,n++,Object.assign(this,t),this.radius=DEFAULT_UNIVERSE_SETTINGS.sizeMultiplier*Math.pow(this.mass/Math.PI*.75,1/3),this.fillStyle=this.isRepeller?"red":"blue",this.fillStyle="rgb("+Math.round(100+155*Math.random())+","+Math.round(100+155*Math.random())+","+Math.round(100+155*Math.random())+")",this.draw=function(){ctx.fillStyle=this.fillStyle,ctx.beginPath(),ctx.arc(this.coords.x,this.coords.y,this.radius,0,2*Math.PI,!1),ctx.fill()},this.draw(),this.calcDistanceFrom=function(t){var e={};return e.x=this.coords.x-t.coords.x,e.y=this.coords.y-t.coords.y,e.total=Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2)),e},this.calcForceFromOther=function(t){var e={},i=this.calcDistanceFrom(t);return e.total=DEFAULT_UNIVERSE_SETTINGS.gravity*this.mass*t.mass/Math.pow(i.total,2),e.direction=Math.atan2(i.y,i.x),e.directionDegs=180*e.direction/Math.PI,i.total<1.2*(this.radius+t.radius)&&(e.total=0,console.log("too close")),e},this.update=function(){if(this.isInfluenced){var t=!0,i=!1,s=void 0;try{for(var o,a=e[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var r=o.value;if(r!==this&&this.isActive&&r.isActive){var n=this.calcForceFromOther(r),l={};l.total=n.total/this.mass,l.x=-l.total*Math.cos(n.direction),l.x=this.isRepeller!==r.isRepeller?-l.x:l.x,l.y=-l.total*Math.sin(n.direction),l.y=this.isRepeller!==r.isRepeller?-l.y:l.y,this.velocity={x:this.velocity.x*(1-DEFAULT_UNIVERSE_SETTINGS.damping/1e5)+l.x,y:this.velocity.y*(1-DEFAULT_UNIVERSE_SETTINGS.damping/1e5)+l.y},this.calcDistanceFrom(r).total<this.radius+r.radius&&(this.remove(),r.remove(),this.combine(r),console.log(e))}}}catch(t){i=!0,s=t}finally{try{!t&&a.return&&a.return()}finally{if(i)throw s}}}this.coords.x+=this.velocity.x,this.coords.y+=this.velocity.y},this.remove=function(){this.isActive=!1;var t=e.indexOf(this);t>-1&&e.splice(t,1)},this.combine=function(t){var i={};i.coords={x:(this.mass*this.coords.x+t.mass*t.coords.x)/(this.mass+t.mass),y:(this.mass*this.coords.y+t.mass*t.coords.y)/(this.mass+t.mass)},i.velocity={x:(this.mass*this.velocity.x+t.mass*t.velocity.x)/(this.mass+t.mass),y:(this.mass*this.velocity.y+t.mass*t.velocity.y)/(this.mass+t.mass)},this.isRepeller===t.isRepeller?(i.mass=this.mass+t.mass,i.isRepeller=this.isRepeller,i.isInfluenced=this.isInfluenced&&t.isInfluenced):this.mass>t.mass?(i.mass=this.mass-t.mass,i.isRepeller=this.isRepeller):this.mass<t.mass?(i.mass=t.mass-this.mass,i.isRepeller=t.isRepeller):i.mass=0,0!==i.mass&&e.push(new MovableBodyV3(i,e))}}function initializeCanvas(){canvas=document.getElementById("field"),canvas.addEventListener("mousedown",onMouseDown,!1),canvas.addEventListener("mouseup",onMouseUp,!1),canvas.addEventListener("contextmenu",function(t){t.preventDefault()},!1),ctx=canvas.getContext("2d"),resizeCanvas()}function onMouseDown(t){clickOrigin={x:t.pageX,y:t.pageY}}function onMouseUp(t){clickDestination={x:t.pageX,y:t.pageY};var e=2===t.button,i={x:clickDestination.x-clickOrigin.x,y:clickDestination.y-clickOrigin.y};movableBodiesV3.push(new MovableBodyV3({mass:1,coords:{x:clickOrigin.x,y:clickOrigin.y},velocity:{x:i.x/100,y:i.y/100},isRepeller:e,isInfluenced:!0},movableBodiesV3))}function resizeCanvas(){canvas.width=window.innerWidth,canvas.height=window.innerHeight,ctx.imageSmoothingEnabled=!0}function updatePositions(){var t=!0,e=!1,i=void 0;try{for(var s,o=fixedBodies[Symbol.iterator]();!(t=(s=o.next()).done);t=!0){var a=s.value;a.update()}}catch(t){e=!0,i=t}finally{try{!t&&o.return&&o.return()}finally{if(e)throw i}}var r=!0,n=!1,l=void 0;try{for(var d,c=movableBodies[Symbol.iterator]();!(r=(d=c.next()).done);r=!0){var h=d.value;h.update()}}catch(t){n=!0,l=t}finally{try{!r&&c.return&&c.return()}finally{if(n)throw l}}var y=!0,v=!1,x=void 0;try{for(var m,u=movableBodiesV2[Symbol.iterator]();!(y=(m=u.next()).done);y=!0){var f=m.value;f.update()}}catch(t){v=!0,x=t}finally{try{!y&&u.return&&u.return()}finally{if(v)throw x}}var p=!0,M=!1,B=void 0;try{for(var w,b=movableBodiesV3[Symbol.iterator]();!(p=(w=b.next()).done);p=!0){var E=w.value;E.update()}}catch(t){M=!0,B=t}finally{try{!p&&b.return&&b.return()}finally{if(M)throw B}}}function redraw(){DEFAULT_UNIVERSE_SETTINGS.eraseTrails&&(ctx.fillStyle="rgba(0, 0, 0, .02)",ctx.fillRect(-2e3,-2e3,4e3,4e3));var t=!0,e=!1,i=void 0;try{for(var s,o=fixedBodies[Symbol.iterator]();!(t=(s=o.next()).done);t=!0){var a=s.value;a.draw()}}catch(t){e=!0,i=t}finally{try{!t&&o.return&&o.return()}finally{if(e)throw i}}var r=!0,n=!1,l=void 0;try{for(var d,c=movableBodies[Symbol.iterator]();!(r=(d=c.next()).done);r=!0){var h=d.value;h.draw()}}catch(t){n=!0,l=t}finally{try{!r&&c.return&&c.return()}finally{if(n)throw l}}var y=!0,v=!1,x=void 0;try{for(var m,u=movableBodiesV2[Symbol.iterator]();!(y=(m=u.next()).done);y=!0){var f=m.value;f.draw()}}catch(t){v=!0,x=t}finally{try{!y&&u.return&&u.return()}finally{if(v)throw x}}var p=!0,M=!1,B=void 0;try{for(var w,b=movableBodiesV3[Symbol.iterator]();!(p=(w=b.next()).done);p=!0){var E=w.value;E.draw()}}catch(t){M=!0,B=t}finally{try{!p&&b.return&&b.return()}finally{if(M)throw B}}}function repeat(t){updatePositions(),redraw(),window.requestAnimationFrame(repeat)}var DEFAULT_UNIVERSE_SETTINGS={gravity:4,sizeMultiplier:5,damping:0,eraseTrails:!1},canvas,ctx,n=0,fixedBodies=[],movableBodies=[],movableBodiesV2=[],movableBodiesV3=[],sun,sun2,sun3,earth,mars;$(document).ready(function(){movableBodiesV3.push(new MovableBodyV3({mass:5e3,coords:{x:500,y:500},velocity:{x:0,y:0},isRepeller:!1,isInfluenced:!1},movableBodiesV3))});var scale=1,originx=0,originy=0,clickOrigin={},clickDestination={};document.addEventListener("DOMContentLoaded",function(t){initializeCanvas(),canvas.onmousewheel=function(t){ctx.clearRect(-5e3,-5e3,1e4,1e4);var e=t.clientX-canvas.offsetLeft,i=t.clientY-canvas.offsetTop,s=t.wheelDelta/120,o=1+s/6;ctx.translate(originx,originy),ctx.scale(o,o),ctx.translate(-(e/scale+originx-e/(scale*o)),-(i/scale+originy-i/(scale*o))),originx=e/scale+originx-e/(scale*o),originy=i/scale+originy-i/(scale*o),scale*=o}}),window.addEventListener("resize",resizeCanvas,!1),window.requestAnimationFrame(repeat);var saves={singleOrbiter:function(){fixedBodies.push(new FixedBody(30,{x:-1e3,y:-1e3},{x:.2,y:.1},!1)),movableBodies.push(new MovableBody(5,{x:-800,y:-800},{x:1,y:-1},!1))},twoAttractors1:function(){fixedBodies.push(new FixedBody(30,{x:0,y:0},!1)),fixedBodies.push(new FixedBody(10,{x:-300,y:-300},!1));for(var t=0;t<1;t++)for(var e=0;e<30;e++)movableBodies.push(new MovableBody(5,{x:5*t,y:300+3*e},{x:1+.2*(t/20),y:-1+1*(e/30)},!1))},attractorAndRepeller:function(){fixedBodies.push(new FixedBody(30,{x:0,y:0},!1)),fixedBodies.push(new FixedBody(10,{x:-300,y:-300},!0));for(var t=0;t<1;t++)for(var e=0;e<30;e++)movableBodies.push(new MovableBody(5,{x:5*t,y:300+3*e},{x:1+.2*(t/20),y:-1+1*(e/30)},!1))},manyRepellers:function(){fixedBodies.push(new FixedBody(30,{x:-300,y:-300},!0)),fixedBodies.push(new FixedBody(30,{x:300,y:-300},!0)),fixedBodies.push(new FixedBody(30,{x:-300,y:300},!0)),fixedBodies.push(new FixedBody(30,{x:300,y:300},!0)),fixedBodies.push(new FixedBody(30,{x:450,y:0},!0)),fixedBodies.push(new FixedBody(30,{x:-450,y:0},!0)),fixedBodies.push(new FixedBody(30,{x:0,y:450},!0)),fixedBodies.push(new FixedBody(30,{x:0,y:-450},!0)),fixedBodies.push(new FixedBody(20,{x:60,y:30},!0));for(var t=0;t<30;t++)for(var e=0;e<30;e++)movableBodies.push(new MovableBody(5,{x:-200.5+15*t+.5*Math.random(),y:-200.5+15*e+.5*Math.random()},{x:0,y:0},!1))},manyRepellersRandom:function(){fixedBodies.push(new FixedBody(20+5*Math.random(),{x:-500+100*Math.random(),y:-500+100*Math.random()},!0)),fixedBodies.push(new FixedBody(20+5*Math.random(),{x:-300+100*Math.random(),y:300+100*Math.random()},!0)),fixedBodies.push(new FixedBody(20+5*Math.random(),{x:400+100*Math.random(),y:-200+100*Math.random()},!0));for(var t=0;t<50;t++)for(var e=0;e<50;e++)movableBodies.push(new MovableBody(5,{x:-500.5+20*t+.5*Math.random(),y:-500.5+20*e+.5*Math.random()},{x:0,y:0},!1))},oneAttractorManyPlanets:function(){fixedBodies.push(new FixedBody(20+5*Math.random(),{x:-100+200*Math.random(),y:-100+200*Math.random()},!1));for(var t=0;t<50;t++)for(var e=0;e<50;e++)movableBodies.push(new MovableBody(5,{x:-500.5+20*t+.5*Math.random(),y:-500.5+20*e+.5*Math.random()},{x:2,y:0},!1))},oneAttractorManyPlanets2:function(){fixedBodies.push(new FixedBody(30+5*Math.random(),{x:-100+200*Math.random(),y:-100+200*Math.random()},!1));for(var t=0;t<25;t++)for(var e=0;e<25;e++)movableBodies.push(new MovableBody(5,{x:-300.5+4*t+.5*Math.random(),y:-300.5+4*e+.5*Math.random()},{x:1,y:0},!1))},oneAttractorManyPlanets3:function(){var t={x:-200,y:-200},e=50,i=10,s=20;fixedBodies.push(new FixedBody(60+5*Math.random(),{x:-100+200*Math.random(),y:-100+200*Math.random()},!1));for(var o=1;o<=i;o++){for(var a=0;a<s;a++)movableBodies.push(new MovableBody(5,{x:t.x+e*(o/i)*Math.sin(360*a/s/180*Math.PI),y:t.y+e*(o/i)*Math.cos(Math.PI*(360*a/s)/180)},{x:1,y:-1},!1));s+=5}}};