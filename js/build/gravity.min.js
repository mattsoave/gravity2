"use strict";function Universe(e){var t=[],i=[];this.addBody=function(e){switch(e.type){case"fixed":t.push(new MovableBody(e.mass,e.coords,e.isRepeller));break;case"movable":i.push(new MovableBody(e.mass,e.coords,e.velocity,!1))}}}function Body(e,t,i,o){this.id=n,this.isActive=!0,n++,this.mass=e,this.coords=t,this.velocity=i,this.radius=DEFAULT_UNIVERSE_SETTINGS.sizeMultiplier*Math.pow(e/Math.PI*.75,1/3),this.isRepeller=o,this.fillStyle=o?"red":"blue",this.draw=function(){ctx.fillStyle=this.fillStyle,ctx.beginPath(),ctx.arc(this.coords.x,this.coords.y,this.radius,0,2*Math.PI,!1),ctx.fill()},this.draw()}function FixedBody(e,t,i,o){Body.call(this,e,t,i,o),this.update=function(){this.velocity={x:this.velocity.x*(1-DEFAULT_UNIVERSE_SETTINGS.damping/1e5),y:this.velocity.y*(1-DEFAULT_UNIVERSE_SETTINGS.damping/1e5)},this.coords.x+=this.velocity.x,this.coords.y+=this.velocity.y}}function MovableBody(e,t,i,o){Body.call(this,e,t,i,o),this.calcDistanceFrom=function(e){var t={};return t.x=this.coords.x-e.coords.x,t.y=this.coords.y-e.coords.y,t.total=Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2)),t},this.calcForceFromOther=function(e){var t={},i=this.calcDistanceFrom(e);return t.total=DEFAULT_UNIVERSE_SETTINGS.gravity*this.mass*e.mass/Math.pow(i.total,2),t.direction=Math.atan2(i.y,i.x),t.directionDegs=180*t.direction/Math.PI,t},this.update=function(){var e=!0,t=!1,i=void 0;try{for(var o,a=movableBodies[Symbol.iterator]();!(e=(o=a.next()).done);e=!0){var s=o.value;console.log(s===this)}}catch(e){t=!0,i=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw i}}var r=!0,n=!1,d=void 0;try{for(var l,c=fixedBodies[Symbol.iterator]();!(r=(l=c.next()).done);r=!0){var y=l.value,h=this.calcForceFromOther(y),v={};v.total=h.total/this.mass,v.x=-v.total*Math.cos(h.direction),v.x=y.isRepeller?-v.x:v.x,v.y=-v.total*Math.sin(h.direction),v.y=y.isRepeller?-v.y:v.y,this.velocity={x:this.velocity.x*(1-DEFAULT_UNIVERSE_SETTINGS.damping/1e5)+v.x,y:this.velocity.y*(1-DEFAULT_UNIVERSE_SETTINGS.damping/1e5)+v.y}}}catch(e){n=!0,d=e}finally{try{!r&&c.return&&c.return()}finally{if(n)throw d}}this.coords.x+=this.velocity.x,this.coords.y+=this.velocity.y}}function MovableBodyV2(e,t,i,o,a){Body.call(this,e,t,i,o),this.calcDistanceFrom=function(e){var t={};return t.x=this.coords.x-e.coords.x,t.y=this.coords.y-e.coords.y,t.total=Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2)),t},this.calcForceFromOther=function(e){var t={},i=this.calcDistanceFrom(e);return t.total=DEFAULT_UNIVERSE_SETTINGS.gravity*this.mass*e.mass/Math.pow(i.total,2),t.direction=Math.atan2(i.y,i.x),t.directionDegs=180*t.direction/Math.PI,i.total<1.2*(this.radius+e.radius)&&(t.total=0,console.log("too close")),t},this.update=function(){var e=!0,t=!1,i=void 0;try{for(var o,s=a[Symbol.iterator]();!(e=(o=s.next()).done);e=!0){var r=o.value;if(r!==this&&this.isActive&&r.isActive){var n=this.calcForceFromOther(r),d={};d.total=n.total/this.mass,d.x=-d.total*Math.cos(n.direction),d.x=this.isRepeller!==r.isRepeller?-d.x:d.x,d.y=-d.total*Math.sin(n.direction),d.y=this.isRepeller!==r.isRepeller?-d.y:d.y,this.velocity={x:this.velocity.x*(1-DEFAULT_UNIVERSE_SETTINGS.damping/1e5)+d.x,y:this.velocity.y*(1-DEFAULT_UNIVERSE_SETTINGS.damping/1e5)+d.y},this.calcDistanceFrom(r).total<this.radius+r.radius&&(this.remove(),r.remove(),this.combine(r),console.log(a))}}}catch(e){t=!0,i=e}finally{try{!e&&s.return&&s.return()}finally{if(t)throw i}}this.coords.x+=this.velocity.x,this.coords.y+=this.velocity.y},this.remove=function(){this.isActive=!1;var e=a.indexOf(this);e>-1&&a.splice(e,1)},this.combine=function(e){var t,i=this.coords,o={x:(this.mass*this.velocity.x+e.mass*e.velocity.x)/(this.mass+e.mass),y:(this.mass*this.velocity.y+e.mass*e.velocity.y)/(this.mass+e.mass)};this.isRepeller===e.isRepeller?(t=this.mass+e.mass,console.log(t),a.push(new MovableBodyV2(t,i,o,this.isRepeller,a))):this.mass>e.mass?(t=this.mass-e.mass,a.push(new MovableBodyV2(t,i,o,this.isRepeller,a))):this.mass<e.mass&&(t=e.mass-this.mass,a.push(new MovableBodyV2(t,i,o,e.isRepeller,a))),console.log(this.mass+" + "+e.mass+" = "+t)}}function initializeCanvas(){canvas=document.getElementById("field"),canvas.addEventListener("mousedown",onMouseDown,!1),canvas.addEventListener("mouseup",onMouseUp,!1),canvas.addEventListener("contextmenu",function(e){e.preventDefault()},!1),ctx=canvas.getContext("2d"),resizeCanvas()}function onMouseDown(e){clickOrigin={x:e.pageX,y:e.pageY}}function onMouseUp(e){clickDestination={x:e.pageX,y:e.pageY};var t=2===e.button,i={x:clickDestination.x-clickOrigin.x,y:clickDestination.y-clickOrigin.y};movableBodiesV2.push(new MovableBodyV2(5,{x:clickOrigin.x,y:clickOrigin.y},{x:i.x/100,y:i.y/100},t,movableBodiesV2))}function resizeCanvas(){canvas.width=window.innerWidth,canvas.height=window.innerHeight,ctx.imageSmoothingEnabled=!0}function updatePositions(){var e=!0,t=!1,i=void 0;try{for(var o,a=fixedBodies[Symbol.iterator]();!(e=(o=a.next()).done);e=!0){var s=o.value;s.update()}}catch(e){t=!0,i=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw i}}var r=!0,n=!1,d=void 0;try{for(var l,c=movableBodies[Symbol.iterator]();!(r=(l=c.next()).done);r=!0){var y=l.value;y.update()}}catch(e){n=!0,d=e}finally{try{!r&&c.return&&c.return()}finally{if(n)throw d}}var h=!0,v=!1,x=void 0;try{for(var u,f=movableBodiesV2[Symbol.iterator]();!(h=(u=f.next()).done);h=!0){var m=u.value;m.update()}}catch(e){v=!0,x=e}finally{try{!h&&f.return&&f.return()}finally{if(v)throw x}}}function redraw(){ctx.fillStyle="rgba(0, 0, 0, .02)",ctx.fillRect(-2e3,-2e3,4e3,4e3);var e=!0,t=!1,i=void 0;try{for(var o,a=fixedBodies[Symbol.iterator]();!(e=(o=a.next()).done);e=!0){var s=o.value;s.draw()}}catch(e){t=!0,i=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw i}}var r=!0,n=!1,d=void 0;try{for(var l,c=movableBodies[Symbol.iterator]();!(r=(l=c.next()).done);r=!0){var y=l.value;y.draw()}}catch(e){n=!0,d=e}finally{try{!r&&c.return&&c.return()}finally{if(n)throw d}}var h=!0,v=!1,x=void 0;try{for(var u,f=movableBodiesV2[Symbol.iterator]();!(h=(u=f.next()).done);h=!0){var m=u.value;m.draw()}}catch(e){v=!0,x=e}finally{try{!h&&f.return&&f.return()}finally{if(v)throw x}}}function repeat(e){updatePositions(),redraw(),window.requestAnimationFrame(repeat)}var DEFAULT_UNIVERSE_SETTINGS={gravity:20,sizeMultiplier:5,damping:0,eraseTrails:!1},canvas,ctx,n=0,fixedBodies=[],movableBodies=[],movableBodiesV2=[],sun,sun2,sun3,earth,mars;$(document).ready(function(){});var scale=1,originx=0,originy=0,clickOrigin={},clickDestination={};document.addEventListener("DOMContentLoaded",function(e){initializeCanvas(),canvas.onmousewheel=function(e){ctx.clearRect(-5e3,-5e3,1e4,1e4);var t=e.clientX-canvas.offsetLeft,i=e.clientY-canvas.offsetTop,o=e.wheelDelta/120,a=1+o/6;ctx.translate(originx,originy),ctx.scale(a,a),ctx.translate(-(t/scale+originx-t/(scale*a)),-(i/scale+originy-i/(scale*a))),originx=t/scale+originx-t/(scale*a),originy=i/scale+originy-i/(scale*a),scale*=a}}),window.addEventListener("resize",resizeCanvas,!1),window.requestAnimationFrame(repeat);var saves={singleOrbiter:function(){fixedBodies.push(new FixedBody(30,{x:-1e3,y:-1e3},{x:.2,y:.1},!1)),movableBodies.push(new MovableBody(5,{x:-800,y:-800},{x:1,y:-1},!1))},twoAttractors1:function(){fixedBodies.push(new FixedBody(30,{x:0,y:0},!1)),fixedBodies.push(new FixedBody(10,{x:-300,y:-300},!1));for(var e=0;e<1;e++)for(var t=0;t<30;t++)movableBodies.push(new MovableBody(5,{x:5*e,y:300+3*t},{x:1+.2*(e/20),y:-1+1*(t/30)},!1))},attractorAndRepeller:function(){fixedBodies.push(new FixedBody(30,{x:0,y:0},!1)),fixedBodies.push(new FixedBody(10,{x:-300,y:-300},!0));for(var e=0;e<1;e++)for(var t=0;t<30;t++)movableBodies.push(new MovableBody(5,{x:5*e,y:300+3*t},{x:1+.2*(e/20),y:-1+1*(t/30)},!1))},manyRepellers:function(){fixedBodies.push(new FixedBody(30,{x:-300,y:-300},!0)),fixedBodies.push(new FixedBody(30,{x:300,y:-300},!0)),fixedBodies.push(new FixedBody(30,{x:-300,y:300},!0)),fixedBodies.push(new FixedBody(30,{x:300,y:300},!0)),fixedBodies.push(new FixedBody(30,{x:450,y:0},!0)),fixedBodies.push(new FixedBody(30,{x:-450,y:0},!0)),fixedBodies.push(new FixedBody(30,{x:0,y:450},!0)),fixedBodies.push(new FixedBody(30,{x:0,y:-450},!0)),fixedBodies.push(new FixedBody(20,{x:60,y:30},!0));for(var e=0;e<30;e++)for(var t=0;t<30;t++)movableBodies.push(new MovableBody(5,{x:-200.5+15*e+.5*Math.random(),y:-200.5+15*t+.5*Math.random()},{x:0,y:0},!1))},manyRepellersRandom:function(){fixedBodies.push(new FixedBody(20+5*Math.random(),{x:-500+100*Math.random(),y:-500+100*Math.random()},!0)),fixedBodies.push(new FixedBody(20+5*Math.random(),{x:-300+100*Math.random(),y:300+100*Math.random()},!0)),fixedBodies.push(new FixedBody(20+5*Math.random(),{x:400+100*Math.random(),y:-200+100*Math.random()},!0));for(var e=0;e<50;e++)for(var t=0;t<50;t++)movableBodies.push(new MovableBody(5,{x:-500.5+20*e+.5*Math.random(),y:-500.5+20*t+.5*Math.random()},{x:0,y:0},!1))},oneAttractorManyPlanets:function(){fixedBodies.push(new FixedBody(20+5*Math.random(),{x:-100+200*Math.random(),y:-100+200*Math.random()},!1));for(var e=0;e<50;e++)for(var t=0;t<50;t++)movableBodies.push(new MovableBody(5,{x:-500.5+20*e+.5*Math.random(),y:-500.5+20*t+.5*Math.random()},{x:2,y:0},!1))},oneAttractorManyPlanets2:function(){fixedBodies.push(new FixedBody(30+5*Math.random(),{x:-100+200*Math.random(),y:-100+200*Math.random()},!1));for(var e=0;e<25;e++)for(var t=0;t<25;t++)movableBodies.push(new MovableBody(5,{x:-300.5+4*e+.5*Math.random(),y:-300.5+4*t+.5*Math.random()},{x:1,y:0},!1))},oneAttractorManyPlanets3:function(){var e={x:-200,y:-200},t=50,i=10,o=20;fixedBodies.push(new FixedBody(60+5*Math.random(),{x:-100+200*Math.random(),y:-100+200*Math.random()},!1));for(var a=1;a<=i;a++){for(var s=0;s<o;s++)movableBodies.push(new MovableBody(5,{x:e.x+t*(a/i)*Math.sin(360*s/o/180*Math.PI),y:e.y+t*(a/i)*Math.cos(Math.PI*(360*s/o)/180)},{x:1,y:-1},!1));o+=5}}};