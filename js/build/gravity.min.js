"use strict";function Universe(o){var e=[],t=[];this.addBody=function(o){switch(o.type){case"fixed":e.push(new MovableBody(o.mass,o.coords,o.isRepeller));break;case"movable":t.push(new MovableBody(o.mass,o.coords,o.velocity,!1))}}}function Body(o,e,t,i){this.id=n,n++,this.mass=o,this.coords=e,this.velocity=t,this.radius=DEFAULT_UNIVERSE_SETTINGS.sizeMultiplier*Math.pow(o/Math.PI*.75,1/3),this.isRepeller=i,this.fillStyle="rgb(0,"+Math.round(100+155*Math.random())+","+Math.round(100+155*Math.random())+")",this.draw=function(){ctx.fillStyle=this.fillStyle,ctx.beginPath(),ctx.arc(this.coords.x-this.radius,this.coords.y-this.radius,this.radius,0,2*Math.PI,!1),ctx.fill()},this.draw()}function FixedBody(o,e,t,i){Body.call(this,o,e,t,i),this.update=function(){this.velocity={x:this.velocity.x*(1-DEFAULT_UNIVERSE_SETTINGS.damping/1e5),y:this.velocity.y*(1-DEFAULT_UNIVERSE_SETTINGS.damping/1e5)},this.coords.x+=this.velocity.x,this.coords.y+=this.velocity.y}}function MovableBody(o,e,t,i){Body.call(this,o,e,t,i),this.calcDistanceFrom=function(o){var e={};return e.x=this.coords.x-o.coords.x,e.y=this.coords.y-o.coords.y,e.total=Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2)),e},this.calcForceFromOther=function(o){var e={},t=this.calcDistanceFrom(o);return e.total=DEFAULT_UNIVERSE_SETTINGS.gravity*this.mass*o.mass/Math.pow(t.total,2),e.direction=Math.atan2(t.y,t.x),e.directionDegs=180*e.direction/Math.PI,e},this.update=function(){var o=!0,e=!1,t=void 0;try{for(var i,a=movableBodies[Symbol.iterator]();!(o=(i=a.next()).done);o=!0){var n=i.value;console.log(n===this)}}catch(o){e=!0,t=o}finally{try{!o&&a.return&&a.return()}finally{if(e)throw t}}var r=!0,s=!1,d=void 0;try{for(var l,c=fixedBodies[Symbol.iterator]();!(r=(l=c.next()).done);r=!0){var y=l.value,h=this.calcForceFromOther(y),x={};x.total=h.total/this.mass,x.x=-x.total*Math.cos(h.direction),x.x=y.isRepeller?-x.x:x.x,x.y=-x.total*Math.sin(h.direction),x.y=y.isRepeller?-x.y:x.y,this.velocity={x:this.velocity.x*(1-DEFAULT_UNIVERSE_SETTINGS.damping/1e5)+x.x,y:this.velocity.y*(1-DEFAULT_UNIVERSE_SETTINGS.damping/1e5)+x.y}}}catch(o){s=!0,d=o}finally{try{!r&&c.return&&c.return()}finally{if(s)throw d}}this.coords.x+=this.velocity.x,this.coords.y+=this.velocity.y}}function MovableBodyV2(o,e,t,i,a){Body.call(this,o,e,t,i),this.calcDistanceFrom=function(o){var e={};return e.x=this.coords.x-o.coords.x,e.y=this.coords.y-o.coords.y,e.total=Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2)),e},this.calcForceFromOther=function(o){var e={},t=this.calcDistanceFrom(o);return e.total=DEFAULT_UNIVERSE_SETTINGS.gravity*this.mass*o.mass/Math.pow(t.total,2),e.direction=Math.atan2(t.y,t.x),e.directionDegs=180*e.direction/Math.PI,t.total<1.5*(this.radius+o.radius)&&(e.total=0,console.log("too close")),e},this.update=function(){var o=!0,e=!1,t=void 0;try{for(var i,n=a[Symbol.iterator]();!(o=(i=n.next()).done);o=!0){var r=i.value;if(r!==this){var s=this.calcForceFromOther(r),d={};d.total=s.total/this.mass,d.x=-d.total*Math.cos(s.direction),d.x=r.isRepeller?-d.x:d.x,d.y=-d.total*Math.sin(s.direction),d.y=r.isRepeller?-d.y:d.y,this.velocity={x:this.velocity.x*(1-DEFAULT_UNIVERSE_SETTINGS.damping/1e5)+d.x,y:this.velocity.y*(1-DEFAULT_UNIVERSE_SETTINGS.damping/1e5)+d.y},this.calcDistanceFrom(r).total<this.radius+r.radius&&(console.log("--------removing--------"),console.log(a),console.log(a.indexOf(this)),console.log(a.indexOf(r)),a.splice(a.indexOf(this),1),a.splice(a.indexOf(r),1),this.combine(r),console.log(a))}}}catch(o){e=!0,t=o}finally{try{!o&&n.return&&n.return()}finally{if(e)throw t}}this.coords.x+=this.velocity.x,this.coords.y+=this.velocity.y},this.combine=function(o){var e=this.mass+o.mass,t=this.coords;console.log("----"),console.log("----"),console.log("this:"),console.log(this.velocity),console.log("----"),console.log("other:"),console.log(o.velocity),console.log("----"),console.log("new:");var i={x:(this.mass*this.velocity.x+o.mass*o.velocity.x)/(this.mass+o.mass),y:(this.mass*this.velocity.y+o.mass*o.velocity.y)/(this.mass+o.mass)};console.log(i),a.push(new MovableBodyV2(e,t,i,!1,a))}}function initializeCanvas(){canvas=document.getElementById("field"),canvas.addEventListener("mousedown",onMouseDown,!1),canvas.addEventListener("mouseup",onMouseUp,!1),ctx=canvas.getContext("2d"),resizeCanvas()}function onMouseDown(o){clickOrigin={x:o.pageX,y:o.pageY},console.log(o)}function onMouseUp(o){clickDestination={x:o.pageX,y:o.pageY};var e={x:clickDestination.x-clickOrigin.x,y:clickDestination.y-clickOrigin.y};console.log(e),movableBodiesV2.push(new MovableBodyV2(20,{x:clickOrigin.x,y:clickOrigin.y},{x:e.x/100,y:e.y/100},!1,movableBodiesV2))}function resizeCanvas(){canvas.width=window.innerWidth,canvas.height=window.innerHeight,ctx.imageSmoothingEnabled=!0}function updatePositions(){var o=!0,e=!1,t=void 0;try{for(var i,a=fixedBodies[Symbol.iterator]();!(o=(i=a.next()).done);o=!0){var n=i.value;n.update()}}catch(o){e=!0,t=o}finally{try{!o&&a.return&&a.return()}finally{if(e)throw t}}var r=!0,s=!1,d=void 0;try{for(var l,c=movableBodies[Symbol.iterator]();!(r=(l=c.next()).done);r=!0){var y=l.value;y.update()}}catch(o){s=!0,d=o}finally{try{!r&&c.return&&c.return()}finally{if(s)throw d}}var h=!0,x=!1,v=void 0;try{for(var u,f=movableBodiesV2[Symbol.iterator]();!(h=(u=f.next()).done);h=!0){var m=u.value;m.update()}}catch(o){x=!0,v=o}finally{try{!h&&f.return&&f.return()}finally{if(x)throw v}}}function redraw(){DEFAULT_UNIVERSE_SETTINGS.eraseTrails&&ctx.clearRect(-2e3,-2e3,4e3,4e3);var o=!0,e=!1,t=void 0;try{for(var i,a=fixedBodies[Symbol.iterator]();!(o=(i=a.next()).done);o=!0){var n=i.value;n.draw()}}catch(o){e=!0,t=o}finally{try{!o&&a.return&&a.return()}finally{if(e)throw t}}var r=!0,s=!1,d=void 0;try{for(var l,c=movableBodies[Symbol.iterator]();!(r=(l=c.next()).done);r=!0){var y=l.value;y.draw()}}catch(o){s=!0,d=o}finally{try{!r&&c.return&&c.return()}finally{if(s)throw d}}var h=!0,x=!1,v=void 0;try{for(var u,f=movableBodiesV2[Symbol.iterator]();!(h=(u=f.next()).done);h=!0){var m=u.value;m.draw()}}catch(o){x=!0,v=o}finally{try{!h&&f.return&&f.return()}finally{if(x)throw v}}}function repeat(o){updatePositions(),redraw(),window.requestAnimationFrame(repeat)}var FPS=10,DEFAULT_UNIVERSE_SETTINGS={gravity:20,sizeMultiplier:5,damping:0,eraseTrails:!0},canvas,ctx,n=0,fixedBodies=[],movableBodies=[],movableBodiesV2=[],sun,sun2,sun3,earth,mars;$(document).ready(function(){});var scale=1,originx=0,originy=0,clickOrigin={},clickDestination={};document.addEventListener("DOMContentLoaded",function(o){initializeCanvas(),canvas.onmousewheel=function(o){ctx.clearRect(-5e3,-5e3,1e4,1e4);var e=o.clientX-canvas.offsetLeft,t=o.clientY-canvas.offsetTop,i=o.wheelDelta/120,a=1+i/6;ctx.translate(originx,originy),ctx.scale(a,a),ctx.translate(-(e/scale+originx-e/(scale*a)),-(t/scale+originy-t/(scale*a))),originx=e/scale+originx-e/(scale*a),originy=t/scale+originy-t/(scale*a),scale*=a}}),window.addEventListener("resize",resizeCanvas,!1),window.requestAnimationFrame(repeat);var saves={singleOrbiter:function(){fixedBodies.push(new FixedBody(30,{x:-1e3,y:-1e3},{x:.2,y:.1},!1)),movableBodies.push(new MovableBody(5,{x:-800,y:-800},{x:1,y:-1},!1))},twoAttractors1:function(){fixedBodies.push(new FixedBody(30,{x:0,y:0},!1)),fixedBodies.push(new FixedBody(10,{x:-300,y:-300},!1));for(var o=0;o<1;o++)for(var e=0;e<30;e++)movableBodies.push(new MovableBody(5,{x:5*o,y:300+3*e},{x:1+.2*(o/20),y:-1+1*(e/30)},!1))},attractorAndRepeller:function(){fixedBodies.push(new FixedBody(30,{x:0,y:0},!1)),fixedBodies.push(new FixedBody(10,{x:-300,y:-300},!0));for(var o=0;o<1;o++)for(var e=0;e<30;e++)movableBodies.push(new MovableBody(5,{x:5*o,y:300+3*e},{x:1+.2*(o/20),y:-1+1*(e/30)},!1))},manyRepellers:function(){fixedBodies.push(new FixedBody(30,{x:-300,y:-300},!0)),fixedBodies.push(new FixedBody(30,{x:300,y:-300},!0)),fixedBodies.push(new FixedBody(30,{x:-300,y:300},!0)),fixedBodies.push(new FixedBody(30,{x:300,y:300},!0)),fixedBodies.push(new FixedBody(30,{x:450,y:0},!0)),fixedBodies.push(new FixedBody(30,{x:-450,y:0},!0)),fixedBodies.push(new FixedBody(30,{x:0,y:450},!0)),fixedBodies.push(new FixedBody(30,{x:0,y:-450},!0)),fixedBodies.push(new FixedBody(20,{x:60,y:30},!0));for(var o=0;o<30;o++)for(var e=0;e<30;e++)movableBodies.push(new MovableBody(5,{x:-200.5+15*o+.5*Math.random(),y:-200.5+15*e+.5*Math.random()},{x:0,y:0},!1))},manyRepellersRandom:function(){fixedBodies.push(new FixedBody(20+5*Math.random(),{x:-500+100*Math.random(),y:-500+100*Math.random()},!0)),fixedBodies.push(new FixedBody(20+5*Math.random(),{x:-300+100*Math.random(),y:300+100*Math.random()},!0)),fixedBodies.push(new FixedBody(20+5*Math.random(),{x:400+100*Math.random(),y:-200+100*Math.random()},!0));for(var o=0;o<50;o++)for(var e=0;e<50;e++)movableBodies.push(new MovableBody(5,{x:-500.5+20*o+.5*Math.random(),y:-500.5+20*e+.5*Math.random()},{x:0,y:0},!1))},oneAttractorManyPlanets:function(){fixedBodies.push(new FixedBody(20+5*Math.random(),{x:-100+200*Math.random(),y:-100+200*Math.random()},!1));for(var o=0;o<50;o++)for(var e=0;e<50;e++)movableBodies.push(new MovableBody(5,{x:-500.5+20*o+.5*Math.random(),y:-500.5+20*e+.5*Math.random()},{x:2,y:0},!1))},oneAttractorManyPlanets2:function(){fixedBodies.push(new FixedBody(30+5*Math.random(),{x:-100+200*Math.random(),y:-100+200*Math.random()},!1));for(var o=0;o<25;o++)for(var e=0;e<25;e++)movableBodies.push(new MovableBody(5,{x:-300.5+4*o+.5*Math.random(),y:-300.5+4*e+.5*Math.random()},{x:1,y:0},!1))},oneAttractorManyPlanets3:function(){var o={x:-200,y:-200},e=50,t=10,i=20;fixedBodies.push(new FixedBody(60+5*Math.random(),{x:-100+200*Math.random(),y:-100+200*Math.random()},!1));for(var a=1;a<=t;a++){for(var n=0;n<i;n++)movableBodies.push(new MovableBody(5,{x:o.x+e*(a/t)*Math.sin(360*n/i/180*Math.PI),y:o.y+e*(a/t)*Math.cos(Math.PI*(360*n/i)/180)},{x:1,y:-1},!1));i+=5}}};